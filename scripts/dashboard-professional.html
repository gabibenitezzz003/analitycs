<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Follow Hub B.4.1 - Motor de Negociaci√≥n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; 
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        :root {
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-tertiary: #111111;
            --border-primary: rgba(255, 255, 255, 0.06);
            --border-secondary: rgba(255, 255, 255, 0.08);
            --text-primary: #ffffff;
            --text-secondary: #a1a1aa;
            --text-tertiary: #71717a;
            --accent-blue: #3b82f6;
            --accent-cyan: #06b6d4;
            --accent-emerald: #10b981;
            --accent-amber: #f59e0b;
        }
        
        body { 
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        
        /* Professional Card Styles */
        .card-premium {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-premium:hover {
            border-color: var(--border-secondary);
            transform: translateY(-1px);
        }
        
        /* Subtle Glow Effects */
        .glow-subtle-blue {
            box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.1),
                        0 2px 8px rgba(59, 130, 246, 0.05);
        }
        
        .glow-subtle-green {
            box-shadow: 0 0 0 1px rgba(16, 185, 129, 0.1),
                        0 2px 8px rgba(16, 185, 129, 0.05);
        }
        
        .glow-subtle-amber {
            box-shadow: 0 0 0 1px rgba(245, 158, 11, 0.1),
                        0 2px 8px rgba(245, 158, 11, 0.05);
        }
        
        /* Status Indicator */
        @keyframes pulse-ring {
            0% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }
            70% {
                box-shadow: 0 0 0 6px rgba(16, 185, 129, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
            }
        }
        
        .pulse-ring {
            animation: pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        /* Progress Bar Animation */
        .progress-bar-animated {
            transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Tab Styles */
        .tab-button {
            position: relative;
            transition: all 0.2s ease;
        }
        
        .tab-button.active {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-cyan));
        }
        
        /* Table Enhancements */
        .table-row {
            transition: all 0.15s ease;
            border-bottom: 1px solid var(--border-primary);
        }
        
        .table-row:hover {
            background: rgba(255, 255, 255, 0.02);
        }
        
        .table-row.selected {
            background: rgba(245, 158, 11, 0.05);
            border-left: 2px solid var(--accent-amber);
        }
        
        /* Map Styles */
        #map { 
            border-radius: 12px;
            border: 1px solid var(--border-primary);
        }
        
        .leaflet-container { 
            background: var(--bg-tertiary);
        }
        
        .leaflet-popup-content-wrapper {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-primary);
            border-radius: 8px;
        }
        
        .leaflet-popup-tip {
            background: var(--bg-secondary);
        }
        
        /* Chart Container */
        .chart-container {
            position: relative;
            height: 100%;
        }
        
        /* Gradient Text */
        .gradient-text-blue {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Badge Styles */
        .badge-status {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.2);
            color: var(--accent-emerald);
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        /* Icon Container */
        .icon-container {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .icon-container::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 14px;
            padding: 1px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.5), rgba(6, 182, 212, 0.5));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
        }
        
        /* Number Animation */
        .metric-number {
            font-variant-numeric: tabular-nums;
            letter-spacing: -0.02em;
        }
        
        /* Enhanced Shadows */
        .shadow-elevated {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
                        0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        /* Hide content by default */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }

        /* Custom Arrow Icon */
        .custom-arrow svg {
            transform: rotate(var(--arrow-rotate, 0deg));
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="max-w-[1920px] mx-auto p-6 lg:p-8">
        <!-- Header -->
        <header class="mb-8">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
                <!-- Brand & Title -->
                <div class="flex items-center gap-4">
                    <div class="icon-container shadow-elevated">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="1" y="3" width="15" height="13"></rect>
                            <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                            <circle cx="5.5" cy="18.5" r="2.5"></circle>
                            <circle cx="18.5" cy="18.5" r="2.5"></circle>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-3xl lg:text-4xl font-bold tracking-tight gradient-text-blue">
                            Motor de Negociaci√≥n B.4.1
                        </h1>
                        <p class="text-sm text-zinc-500 mt-1 font-medium">
                            Follow Hub ¬∑ Dashboard Anal√≠tico en Tiempo Real
                        </p>
                    </div>
                </div>
                
                <!-- Status & Time -->
                <div class="flex items-center gap-4">
                    <div class="badge-status px-4 py-2.5 rounded-full text-sm font-semibold flex items-center gap-2.5">
                        <span class="w-2 h-2 bg-emerald-400 rounded-full pulse-ring"></span>
                        <span>Sistema Operativo</span>
                    </div>
                    <div class="card-premium rounded-xl px-5 py-3">
                        <div class="text-xs text-zinc-500 font-medium">√öltima actualizaci√≥n</div>
                        <div class="text-sm text-white font-semibold mt-0.5">Hoy, 15:42 hs</div>
                    </div>
                </div>
            </div>
            
            <!-- Navigation Tabs -->
            <nav class="mt-8 border-b border-zinc-800/50">
                <div class="flex gap-1 overflow-x-auto">
                    <button onclick="showTab('resumen')" id="tab-resumen" 
                            class="tab-button active px-5 py-3 text-sm font-semibold text-white whitespace-nowrap">
                        <span class="flex items-center gap-2">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="20" x2="18" y2="10"></line>
                                <line x1="12" y1="20" x2="12" y2="4"></line>
                                <line x1="6" y1="20" x2="6" y2="14"></line>
                            </svg>
                            Resumen Ejecutivo
                        </span>
                    </button>
                    <button onclick="showTab('conversion')" id="tab-conversion" 
                            class="tab-button px-5 py-3 text-sm font-semibold text-zinc-500 hover:text-white whitespace-nowrap">
                        <span class="flex items-center gap-2">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                            </svg>
                            An√°lisis Conversi√≥n
                        </span>
                    </button>
                    <button onclick="showTab('ia')" id="tab-ia" 
                            class="tab-button px-5 py-3 text-sm font-semibold text-zinc-500 hover:text-white whitespace-nowrap">
                        <span class="flex items-center gap-2">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                            Performance IA
                        </span>
                    </button>
                    <button onclick="showTab('transportistas')" id="tab-transportistas" 
                            class="tab-button px-5 py-3 text-sm font-semibold text-zinc-500 hover:text-white whitespace-nowrap">
                        <span class="flex items-center gap-2">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="1" y="3" width="15" height="13"></rect>
                                <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                                <circle cx="5.5" cy="18.5" r="2.5"></circle>
                                <circle cx="18.5" cy="18.5" r="2.5"></circle>
                            </svg>
                            Transportistas & Rutas
                        </span>
                    </button>
                    <button onclick="showTab('geo')" id="tab-geo" 
                            class="tab-button px-5 py-3 text-sm font-semibold text-zinc-500 hover:text-white whitespace-nowrap">
                        <span class="flex items-center gap-2">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            Mapa Interactivo
                        </span>
                    </button>
                </div>
            </nav>
        </header>

        <!-- Tab: Resumen Ejecutivo -->
        <div id="content-resumen" class="tab-content active">
            <!-- KPI Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4 mb-6">
                <!-- Interacciones -->
                <div class="card-premium rounded-xl p-6 glow-subtle-blue">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Interacciones</p>
                            <p class="text-3xl font-bold metric-number text-blue-400 mt-2">2,847</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-blue-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="flex items-center gap-1.5 text-xs">
                        <span class="text-emerald-400 font-semibold">‚Üë 12.4%</span>
                        <span class="text-zinc-500">vs semana anterior</span>
                    </div>
                </div>

                <!-- Transportistas -->
                <div class="card-premium rounded-xl p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Transportistas</p>
                            <p class="text-3xl font-bold metric-number text-purple-400 mt-2">892</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-purple-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#a855f7" stroke-width="2">
                                <rect x="1" y="3" width="15" height="13"></rect>
                                <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                                <circle cx="5.5" cy="18.5" r="2.5"></circle>
                                <circle cx="18.5" cy="18.5" r="2.5"></circle>
                            </svg>
                        </div>
                    </div>
                    <div class="flex items-center gap-1.5 text-xs">
                        <span class="text-emerald-400 font-semibold">‚Üë 8.2%</span>
                        <span class="text-zinc-500">vs semana anterior</span>
                    </div>
                </div>

                <!-- Reservas -->
                <div class="card-premium rounded-xl p-6 glow-subtle-green">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Reservas</p>
                            <p class="text-3xl font-bold metric-number text-emerald-400 mt-2">423</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-emerald-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </div>
                    </div>
                    <div class="flex items-center gap-1.5 text-xs">
                        <span class="text-emerald-400 font-semibold">‚Üë 15.7%</span>
                        <span class="text-zinc-500">vs semana anterior</span>
                    </div>
                </div>

                <!-- Tasa Conversi√≥n -->
                <div class="card-premium rounded-xl p-6 glow-subtle-amber">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Tasa Conversi√≥n</p>
                            <p class="text-3xl font-bold metric-number text-amber-400 mt-2">14.9%</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-amber-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </div>
                    </div>
                    <div class="flex items-center gap-1.5 text-xs">
                        <span class="text-emerald-400 font-semibold">‚Üë 2.3%</span>
                        <span class="text-zinc-500">vs semana anterior</span>
                    </div>
                </div>

                <!-- Valor Total -->
                <div class="card-premium rounded-xl p-6 glow-subtle-green">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Valor Total</p>
                            <p class="text-3xl font-bold metric-number text-emerald-400 mt-2">$45.7M</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-emerald-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                                <line x1="12" y1="1" x2="12" y2="23"></line>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="flex items-center gap-1.5 text-xs">
                        <span class="text-emerald-400 font-semibold">‚Üë 18.9%</span>
                        <span class="text-zinc-500">vs semana anterior</span>
                    </div>
                </div>

                <!-- Health Score IA -->
                <div class="card-premium rounded-xl p-6 glow-subtle-blue">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Health Score IA</p>
                            <p class="text-3xl font-bold metric-number text-cyan-400 mt-2">82%</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-cyan-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#06b6d4" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                        </div>
                    </div>
                    <div class="flex items-center gap-1.5 text-xs">
                        <span class="text-emerald-400 font-semibold">‚Üë 5.1%</span>
                        <span class="text-zinc-500">vs semana anterior</span>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <!-- Tendencia Semanal -->
                <div class="lg:col-span-2 card-premium rounded-xl p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-sm font-semibold text-white flex items-center gap-2">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                            </svg>
                            Tendencia Semanal
                        </h3>
                        <div class="flex items-center gap-2 text-xs">
                            <button class="px-3 py-1.5 rounded-lg bg-white/5 text-white font-medium">7D</button>
                            <button class="px-3 py-1.5 rounded-lg text-zinc-500 hover:text-white font-medium">30D</button>
                        </div>
                    </div>
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="chartTendencia"></canvas>
                    </div>
                </div>

                <!-- Distribuci√≥n por Intenci√≥n -->
                <div class="card-premium rounded-xl p-6">
                    <h3 class="text-sm font-semibold text-white mb-6 flex items-center gap-2">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                        Distribuci√≥n por Intenci√≥n
                    </h3>
                    <div class="chart-container mb-6" style="height: 200px;">
                        <canvas id="chartIntenciones"></canvas>
                    </div>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <span class="w-3 h-3 rounded-full bg-blue-500"></span>
                                <span class="text-sm text-zinc-400">Consultar</span>
                            </div>
                            <span class="text-sm font-semibold text-white">45.2%</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <span class="w-3 h-3 rounded-full bg-emerald-500"></span>
                                <span class="text-sm text-zinc-400">Reservar</span>
                            </div>
                            <span class="text-sm font-semibold text-white">28.7%</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <span class="w-3 h-3 rounded-full bg-red-500"></span>
                                <span class="text-sm text-zinc-400">Rechazar</span>
                            </div>
                            <span class="text-sm font-semibold text-white">16.4%</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <span class="w-3 h-3 rounded-full bg-amber-500"></span>
                                <span class="text-sm text-zinc-400">Contraoferta</span>
                            </div>
                            <span class="text-sm font-semibold text-white">9.7%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bottom Row -->
            <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-6 mb-6">
                <!-- Actividad por Hora -->
                <div class="lg:col-span-2 card-premium rounded-xl p-6">
                    <h3 class="text-sm font-semibold text-white mb-6 flex items-center gap-2">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        Actividad por Hora
                    </h3>
                    <div class="chart-container" style="height: 200px;">
                        <canvas id="chartHoras"></canvas>
                    </div>
                </div>

                <!-- M√©tricas IA -->
                <div class="card-premium rounded-xl p-6">
                    <h3 class="text-sm font-semibold text-white mb-6 flex items-center gap-2">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                        M√©tricas IA
                    </h3>
                    <div class="space-y-5">
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm text-zinc-400">Tasa √âxito</span>
                                <span class="text-sm font-bold text-emerald-400">87.3%</span>
                            </div>
                            <div class="w-full bg-zinc-800 rounded-full h-2 overflow-hidden">
                                <div class="bg-gradient-to-r from-emerald-500 to-emerald-400 h-2 rounded-full progress-bar-animated" style="width: 87.3%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm text-zinc-400">Tasa Fallback</span>
                                <span class="text-sm font-bold text-red-400">4.2%</span>
                            </div>
                            <div class="w-full bg-zinc-800 rounded-full h-2 overflow-hidden">
                                <div class="bg-gradient-to-r from-red-500 to-red-400 h-2 rounded-full progress-bar-animated" style="width: 21%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm text-zinc-400">Tiempo Respuesta</span>
                                <span class="text-sm font-bold text-blue-400">1.25s</span>
                            </div>
                            <div class="w-full bg-zinc-800 rounded-full h-2 overflow-hidden">
                                <div class="bg-gradient-to-r from-blue-500 to-cyan-400 h-2 rounded-full progress-bar-animated" style="width: 65%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- An√°lisis Sentimiento -->
                <div class="card-premium rounded-xl p-6">
                    <h3 class="text-sm font-semibold text-white mb-6 flex items-center gap-2">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                            <line x1="9" y1="9" x2="9.01" y2="9"></line>
                            <line x1="15" y1="9" x2="15.01" y2="9"></line>
                        </svg>
                        An√°lisis Sentimiento
                    </h3>
                    <div class="space-y-4">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-lg bg-emerald-500/10 flex items-center justify-center flex-shrink-0">
                                <span class="text-lg">üòä</span>
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between items-center mb-1.5">
                                    <span class="text-sm text-zinc-400">Positivo</span>
                                    <span class="text-sm font-bold text-emerald-400">68.5%</span>
                                </div>
                                <div class="w-full bg-zinc-800 rounded-full h-1.5">
                                    <div class="bg-emerald-500 h-1.5 rounded-full progress-bar-animated" style="width: 68.5%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-lg bg-zinc-700/50 flex items-center justify-center flex-shrink-0">
                                <span class="text-lg">üòê</span>
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between items-center mb-1.5">
                                    <span class="text-sm text-zinc-400">Neutro</span>
                                    <span class="text-sm font-bold text-zinc-400">24.3%</span>
                                </div>
                                <div class="w-full bg-zinc-800 rounded-full h-1.5">
                                    <div class="bg-zinc-500 h-1.5 rounded-full progress-bar-animated" style="width: 24.3%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-lg bg-red-500/10 flex items-center justify-center flex-shrink-0">
                                <span class="text-lg">üòû</span>
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between items-center mb-1.5">
                                    <span class="text-sm text-zinc-400">Negativo</span>
                                    <span class="text-sm font-bold text-red-400">7.2%</span>
                                </div>
                                <div class="w-full bg-zinc-800 rounded-full h-1.5">
                                    <div class="bg-red-500 h-1.5 rounded-full progress-bar-animated" style="width: 7.2%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top Rutas Table -->
            <div class="card-premium rounded-xl p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-sm font-semibold text-white flex items-center gap-2">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        Top 5 Rutas por Valor
                    </h3>
                    <button class="text-xs text-zinc-400 hover:text-white font-medium flex items-center gap-1">
                        Ver todas
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-zinc-800">
                                <th class="text-left py-3 px-4 text-xs font-semibold text-zinc-500 uppercase tracking-wider">Ruta</th>
                                <th class="text-right py-3 px-4 text-xs font-semibold text-zinc-500 uppercase tracking-wider">Valor Total</th>
                                <th class="text-right py-3 px-4 text-xs font-semibold text-zinc-500 uppercase tracking-wider">Interacciones</th>
                                <th class="text-right py-3 px-4 text-xs font-semibold text-zinc-500 uppercase tracking-wider">% Total</th>
                                <th class="py-3 px-4 text-xs font-semibold text-zinc-500 uppercase tracking-wider w-48">Progreso</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="table-row">
                                <td class="py-4 px-4">
                                    <span class="text-sm font-semibold text-blue-400">Buenos Aires ‚Üí Mendoza</span>
                                </td>
                                <td class="text-right py-4 px-4">
                                    <span class="text-sm font-bold text-emerald-400">$8.5M</span>
                                </td>
                                <td class="text-right py-4 px-4">
                                    <span class="text-sm text-zinc-300">425</span>
                                </td>
                                <td class="text-right py-4 px-4">
                                    <span class="text-sm text-zinc-400">18.6%</span>
                                </td>
                                <td class="py-4 px-4">
                                    <div class="w-full bg-zinc-800 rounded-full h-2">
                                        <div class="bg-gradient-to-r from-blue-500 to-cyan-400 h-2 rounded-full" style="width: 100%"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="table-row">
                                <td class="py-4 px-4">
                                    <span class="text-sm font-semibold text-blue-400">Buenos Aires ‚Üí C√≥rdoba</span>
                                </td>
                                <td class="text-right py-4 px-4">
                                    <span class="text-sm font-bold text-emerald-400">$6.2M</span>
                                </td>
                                <td class="text-right py-4 px-4">
                                    <span class="text-sm text-zinc-300">380</span>
                                </td>
                                <td class="text-right py-4 px-4">
                                    <span class="text-sm text-zinc-400">13.6%</span>
                                </td>
                                <td class="py-4 px-4">
                                    <div class="w-full bg-zinc-800 rounded-full h-2">
                                        <div class="bg-gradient-to-r from-blue-500 to-cyan-400 h-2 rounded-full" style="width: 73%"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="table-row">
                                <td class="py-4 px-4">
                                    <span class="text-sm font-semibold text-blue-400">Rosario ‚Üí Buenos Aires</span>
                                </td>
                                <td class="text-right py-4 px-4">
                                    <span class="text-sm font-bold text-emerald-400">$5.1M</span>
                                </td>
                                <td class="text-right py-4 px-4">
                                    <span class="text-sm text-zinc-300">312</span>
                                </td>
                                <td class="text-right py-4 px-4">
                                    <span class="text-sm text-zinc-400">11.2%</span>
                                </td>
                                <td class="py-4 px-4">
                                    <div class="w-full bg-zinc-800 rounded-full h-2">
                                        <div class="bg-gradient-to-r from-blue-500 to-cyan-400 h-2 rounded-full" style="width: 60%"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="table-row">
                                <td class="py-4 px-4">
                                    <span class="text-sm font-semibold text-blue-400">Buenos Aires ‚Üí Tucum√°n</span>
                                </td>
                                <td class="text-right py-4 px-4">
                                    <span class="text-sm font-bold text-emerald-400">$4.8M</span>
                                </td>
                                <td class="text-right py-4 px-4">
                                    <span class="text-sm text-zinc-300">285</span>
                                </td>
                                <td class="text-right py-4 px-4">
                                    <span class="text-sm text-zinc-400">10.5%</span>
                                </td>
                                <td class="py-4 px-4">
                                    <div class="w-full bg-zinc-800 rounded-full h-2">
                                        <div class="bg-gradient-to-r from-blue-500 to-cyan-400 h-2 rounded-full" style="width: 56%"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="table-row">
                                <td class="py-4 px-4">
                                    <span class="text-sm font-semibold text-blue-400">Mendoza ‚Üí Buenos Aires</span>
                                </td>
                                <td class="text-right py-4 px-4">
                                    <span class="text-sm font-bold text-emerald-400">$4.2M</span>
                                </td>
                                <td class="text-right py-4 px-4">
                                    <span class="text-sm text-zinc-300">256</span>
                                </td>
                                <td class="text-right py-4 px-4">
                                    <span class="text-sm text-zinc-400">9.2%</span>
                                </td>
                                <td class="py-4 px-4">
                                    <div class="w-full bg-zinc-800 rounded-full h-2">
                                        <div class="bg-gradient-to-r from-blue-500 to-cyan-400 h-2 rounded-full" style="width: 49%"></div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab: Analysis Conversion -->
        <div id="content-conversion" class="tab-content">
            <!-- KPIs Conversi√≥n -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <div class="card-premium rounded-xl p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Total Consultas</p>
                            <p class="text-3xl font-bold metric-number text-blue-400 mt-2">1,856</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-blue-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="card-premium rounded-xl p-6 glow-subtle-green">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Total Reservas</p>
                            <p class="text-3xl font-bold metric-number text-emerald-400 mt-2">423</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-emerald-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="card-premium rounded-xl p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Total Rechazos</p>
                            <p class="text-3xl font-bold metric-number text-red-400 mt-2">312</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-red-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="card-premium rounded-xl p-6 glow-subtle-amber">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Ratio Reserva/Rechazo</p>
                            <p class="text-3xl font-bold metric-number text-amber-400 mt-2">1.36</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-amber-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2">
                                <path d="M12 20h9"></path>
                                <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Embudo de Conversi√≥n -->
            <div class="card-premium rounded-xl p-8 mb-6">
                <h3 class="text-lg font-semibold text-white mb-8 flex items-center gap-2">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <polyline points="19 12 12 19 5 12"></polyline>
                    </svg>
                    Embudo de Conversi√≥n
                </h3>
                <div class="flex flex-col lg:flex-row items-center justify-center gap-6">
                    <div class="text-center w-full lg:w-auto">
                        <div class="w-full lg:w-72 h-24 bg-gradient-to-r from-blue-600 to-blue-500 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/20 border border-blue-400/20">
                            <div>
                                <div class="text-3xl font-bold">2,847</div>
                                <div class="text-sm text-blue-100 mt-1">Interacciones</div>
                            </div>
                        </div>
                    </div>
                    <div class="text-zinc-600 text-2xl hidden lg:block">‚Üí</div>
                    <div class="text-center w-full lg:w-auto">
                        <div class="w-full lg:w-60 h-24 bg-gradient-to-r from-amber-600 to-amber-500 rounded-xl flex items-center justify-center shadow-lg shadow-amber-500/20 border border-amber-400/20">
                            <div>
                                <div class="text-3xl font-bold">1,856</div>
                                <div class="text-sm text-amber-100 mt-1">Consultas (65.2%)</div>
                            </div>
                        </div>
                    </div>
                    <div class="text-zinc-600 text-2xl hidden lg:block">‚Üí</div>
                    <div class="text-center w-full lg:w-auto">
                        <div class="w-full lg:w-48 h-24 bg-gradient-to-r from-emerald-600 to-emerald-500 rounded-xl flex items-center justify-center shadow-lg shadow-emerald-500/20 border border-emerald-400/20">
                            <div>
                                <div class="text-3xl font-bold">423</div>
                                <div class="text-sm text-emerald-100 mt-1">Reservas (14.9%)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Conversi√≥n -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card-premium rounded-xl p-6">
                    <h3 class="text-sm font-semibold text-white mb-5">Conversi√≥n por D√≠a de la Semana</h3>
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="chartConversionDia"></canvas>
                    </div>
                </div>
                <div class="card-premium rounded-xl p-6">
                    <h3 class="text-sm font-semibold text-white mb-5">Reservas vs Rechazos por D√≠a</h3>
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="chartReservasRechazos"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Performance IA -->
        <div id="content-ia" class="tab-content">
            <!-- KPIs IA -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <div class="card-premium rounded-xl p-6 glow-subtle-green">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Tasa √âxito IA</p>
                            <p class="text-3xl font-bold metric-number text-emerald-400 mt-2">87.3%</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-emerald-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="card-premium rounded-xl p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Tasa Fallback</p>
                            <p class="text-3xl font-bold metric-number text-red-400 mt-2">4.2%</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-red-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2">
                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                                <line x1="12" y1="9" x2="12" y2="13"></line>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="card-premium rounded-xl p-6 glow-subtle-blue">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Con Contexto</p>
                            <p class="text-3xl font-bold metric-number text-blue-400 mt-2">72.8%</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-blue-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="card-premium rounded-xl p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Tiempo Respuesta</p>
                            <p class="text-3xl font-bold metric-number text-cyan-400 mt-2">1.25s</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-cyan-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#06b6d4" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts IA -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card-premium rounded-xl p-6">
                    <h3 class="text-sm font-semibold text-white mb-5">Distribuci√≥n de Acciones IA</h3>
                    <div class="chart-container" style="height: 320px;">
                        <canvas id="chartAccionesIA"></canvas>
                    </div>
                </div>
                <div class="card-premium rounded-xl p-6">
                    <h3 class="text-sm font-semibold text-white mb-5">Tiempo Respuesta por Hora</h3>
                    <div class="chart-container" style="height: 320px;">
                        <canvas id="chartTiempoRespuesta"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Transportistas & Rutas -->
        <div id="content-transportistas" class="tab-content">
            <!-- KPIs Transportistas -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
                <div class="card-premium rounded-xl p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Total Transportistas</p>
                            <p class="text-3xl font-bold metric-number text-purple-400 mt-2">892</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-purple-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#a855f7" stroke-width="2">
                                <rect x="1" y="3" width="15" height="13"></rect>
                                <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                                <circle cx="5.5" cy="18.5" r="2.5"></circle>
                                <circle cx="18.5" cy="18.5" r="2.5"></circle>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="card-premium rounded-xl p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Activos Hoy</p>
                            <p class="text-3xl font-bold metric-number text-emerald-400 mt-2">234</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-emerald-500/10 flex items-center justify-center">
                            <span class="w-3 h-3 bg-emerald-400 rounded-full pulse-ring"></span>
                        </div>
                    </div>
                </div>

                <div class="card-premium rounded-xl p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Recurrentes</p>
                            <p class="text-3xl font-bold metric-number text-blue-400 mt-2">67.8%</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-blue-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2">
                                <polyline points="23 4 23 10 17 10"></polyline>
                                <polyline points="1 20 1 14 7 14"></polyline>
                                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="card-premium rounded-xl p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Prom. Viajes/Transp</p>
                            <p class="text-3xl font-bold metric-number text-amber-400 mt-2">3.2</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-amber-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2">
                                <line x1="18" y1="20" x2="18" y2="10"></line>
                                <line x1="12" y1="20" x2="12" y2="4"></line>
                                <line x1="6" y1="20" x2="6" y2="14"></line>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="card-premium rounded-xl p-6 glow-subtle-amber">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Top Performer</p>
                            <p class="text-xl font-bold text-amber-400 mt-2">Juan P√©rez</p>
                            <p class="text-xs text-zinc-500 mt-1">45 viajes este mes</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-amber-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2">
                                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
                                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
                                <path d="M4 22h16"></path>
                                <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
                                <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
                                <path d="M18 2H6v7a6 6 0 0 0 12 0V2z"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Lista de Transportistas -->
                <div class="card-premium rounded-xl p-6">
                    <div class="flex items-center justify-between mb-5">
                        <h3 class="text-sm font-semibold text-white flex items-center gap-2">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            Transportistas
                        </h3>
                        <input type="text" id="searchTransportista" placeholder="Buscar..." 
                               class="bg-zinc-900 border border-zinc-800 rounded-lg px-3 py-1.5 text-xs text-white placeholder-zinc-600 focus:outline-none focus:border-blue-500 w-32"
                               onkeyup="filterTransportistas()">
                    </div>
                    <div class="space-y-2 max-h-[500px] overflow-y-auto" id="transportistasList">
                        <!-- Filled by JavaScript -->
                    </div>
                </div>

                <!-- Detalle del Transportista -->
                <div class="lg:col-span-2 card-premium rounded-xl p-6">
                    <div id="transportistaDetail" class="hidden">
                        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-4">
                            <div class="flex items-center gap-4">
                                <div class="w-16 h-16 bg-gradient-to-br from-amber-500 to-orange-500 rounded-2xl flex items-center justify-center shadow-lg shadow-amber-500/30">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                        <rect x="1" y="3" width="15" height="13"></rect>
                                        <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                                        <circle cx="5.5" cy="18.5" r="2.5"></circle>
                                        <circle cx="18.5" cy="18.5" r="2.5"></circle>
                                    </svg>
                                </div>
                                <div>
                                    <h2 class="text-2xl font-bold text-white" id="detailNombre">Juan P√©rez</h2>
                                    <p class="text-zinc-400 text-sm" id="detailTelefono">+54 11 1234-5678</p>
                                </div>
                            </div>
                            <div class="text-left sm:text-right">
                                <div class="text-3xl font-bold text-amber-400" id="detailScore">92%</div>
                                <div class="text-xs text-zinc-500">Score Predictivo</div>
                            </div>
                        </div>

                        <!-- Stats Grid -->
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6">
                            <div class="bg-zinc-900/50 rounded-lg p-4 text-center border border-zinc-800">
                                <div class="text-2xl font-bold text-blue-400" id="detailViajes">45</div>
                                <div class="text-xs text-zinc-500 mt-1">Viajes Totales</div>
                            </div>
                            <div class="bg-zinc-900/50 rounded-lg p-4 text-center border border-zinc-800">
                                <div class="text-2xl font-bold text-emerald-400" id="detailReservas">38</div>
                                <div class="text-xs text-zinc-500 mt-1">Reservas</div>
                            </div>
                            <div class="bg-zinc-900/50 rounded-lg p-4 text-center border border-zinc-800">
                                <div class="text-2xl font-bold text-amber-400" id="detailConversion">84%</div>
                                <div class="text-xs text-zinc-500 mt-1">Tasa Conversi√≥n</div>
                            </div>
                            <div class="bg-zinc-900/50 rounded-lg p-4 text-center border border-zinc-800">
                                <div class="text-2xl font-bold text-purple-400" id="detailValor">$2.4M</div>
                                <div class="text-xs text-zinc-500 mt-1">Valor Generado</div>
                            </div>
                        </div>

                        <!-- Historial de Rutas -->
                        <h4 class="text-sm font-semibold text-white mb-3 flex items-center justify-between">
                            <span class="flex items-center gap-2">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                    <circle cx="12" cy="10" r="3"></circle>
                                </svg>
                                Historial de Rutas
                            </span>
                            <span class="text-xs text-zinc-600 font-normal">Clic para ver en mapa</span>
                        </h4>
                        <div class="space-y-2 max-h-56 overflow-y-auto mb-6" id="rutasHistorial">
                            <!-- Filled by JavaScript -->
                        </div>

                        <!-- Predicci√≥n de Cargas -->
                        <div class="p-5 bg-gradient-to-r from-amber-500/5 to-orange-500/5 border border-amber-500/20 rounded-xl">
                            <h4 class="text-sm font-semibold text-amber-400 mb-4 flex items-center gap-2">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                </svg>
                                Cargas Recomendadas (An√°lisis Predictivo)
                            </h4>
                            <div id="cargasRecomendadas" class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                <!-- Filled by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Placeholder -->
                    <div id="transportistaPlaceholder" class="flex flex-col items-center justify-center h-[500px] text-center">
                        <div class="w-20 h-20 rounded-2xl bg-zinc-900 flex items-center justify-center mb-4">
                            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="text-zinc-600">
                                <path d="M9 11l3 3L22 4"></path>
                                <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"></path>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold text-zinc-500">Selecciona un Transportista</h3>
                        <p class="text-zinc-600 mt-2 max-w-sm">Haz clic en un transportista de la lista para ver su historial de rutas y predicciones de carga</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Mapa Interactivo -->
        <div id="content-geo" class="tab-content">
            <!-- KPIs Mapa -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <div class="card-premium rounded-xl p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Rutas Activas</p>
                            <p class="text-3xl font-bold metric-number text-blue-400 mt-2">47</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-blue-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="card-premium rounded-xl p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Top Origen</p>
                            <p class="text-2xl font-bold text-purple-400 mt-2">Buenos Aires</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-purple-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#a855f7" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="card-premium rounded-xl p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Top Destino</p>
                            <p class="text-2xl font-bold text-cyan-400 mt-2">Mendoza</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-cyan-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#06b6d4" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="card-premium rounded-xl p-6 glow-subtle-amber">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Transportista Activo</p>
                            <p class="text-lg font-bold text-amber-400 mt-2" id="mapTransportistaActivo">Ninguno seleccionado</p>
                        </div>
                        <div class="w-10 h-10 rounded-lg bg-amber-500/10 flex items-center justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2">
                                <rect x="1" y="3" width="15" height="13"></rect>
                                <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                                <circle cx="5.5" cy="18.5" r="2.5"></circle>
                                <circle cx="18.5" cy="18.5" r="2.5"></circle>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <!-- Lista Transportistas para Mapa -->
                <div class="card-premium rounded-xl p-6">
                    <h3 class="text-sm font-semibold text-white mb-5 flex items-center gap-2">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="1" y="3" width="15" height="13"></rect>
                            <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                            <circle cx="5.5" cy="18.5" r="2.5"></circle>
                            <circle cx="18.5" cy="18.5" r="2.5"></circle>
                        </svg>
                        Seleccionar Transportista
                    </h3>
                    <div class="space-y-2 max-h-[540px] overflow-y-auto" id="mapTransportistasList">
                        <!-- Filled by JavaScript -->
                    </div>
                </div>

                <!-- MAPA -->
                <div class="lg:col-span-3 card-premium rounded-xl p-5">
                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 gap-3">
                        <h3 class="text-sm font-semibold text-white flex items-center gap-2">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            Mapa de Rutas - Argentina
                        </h3>
                        <div class="flex items-center gap-4 text-xs">
                            <div class="flex items-center gap-1.5">
                                <span class="w-2.5 h-2.5 rounded-full bg-emerald-500"></span>
                                <span class="text-zinc-400">Origen</span>
                            </div>
                            <div class="flex items-center gap-1.5">
                                <span class="w-2.5 h-2.5 rounded-full bg-red-500"></span>
                                <span class="text-zinc-400">Destino</span>
                            </div>
                            <div class="flex items-center gap-1.5">
                                <div class="w-8 h-1 bg-gradient-to-r from-amber-400 to-amber-600 rounded"></div>
                                <span class="text-zinc-400">Ruta</span>
                            </div>
                        </div>
                    </div>
                    <div id="map" style="height: 560px; width: 100%;"></div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="mt-12 pt-6 border-t border-zinc-800/50">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4 text-xs text-zinc-600">
                <span>Follow Hub ¬© 2026 ¬∑ Motor de Negociaci√≥n B.4.1</span>
                <span>90 Medidas DAX ¬∑ 4 Tablas ¬∑ Mapa Interactivo ¬∑ An√°lisis Predictivo</span>
            </div>
        </footer>
    </div>

    <script>
        // ============================================
        // DATOS DE TRANSPORTISTAS Y RUTAS
        // ============================================
        const transportistas = [
            {
                id: 1, nombre: "Juan P√©rez", telefono: "+54 11 1234-5678", score: 92,
                viajes: 45, reservas: 38, conversion: 84, valor: 2400000,
                rutas: [
                    { origen: "Buenos Aires", destino: "Mendoza", fecha: "2026-01-02", valor: 85000, tipo: "FTL" },
                    { origen: "Mendoza", destino: "Buenos Aires", fecha: "2026-01-01", valor: 78000, tipo: "FTL" },
                    { origen: "Buenos Aires", destino: "C√≥rdoba", fecha: "2025-12-30", valor: 62000, tipo: "LTL" },
                    { origen: "C√≥rdoba", destino: "Rosario", fecha: "2025-12-28", valor: 45000, tipo: "LTL" },
                    { origen: "Rosario", destino: "Buenos Aires", fecha: "2025-12-26", valor: 52000, tipo: "FTL" }
                ],
                cargasRecomendadas: [
                    { ruta: "Buenos Aires ‚Üí Mendoza", probabilidad: 94, valor: "$85,000" },
                    { ruta: "Buenos Aires ‚Üí San Juan", probabilidad: 78, valor: "$72,000" }
                ]
            },
            {
                id: 2, nombre: "Mar√≠a Gonz√°lez", telefono: "+54 351 987-6543", score: 88,
                viajes: 38, reservas: 31, conversion: 82, valor: 1850000,
                rutas: [
                    { origen: "C√≥rdoba", destino: "Buenos Aires", fecha: "2026-01-02", valor: 62000, tipo: "FTL" },
                    { origen: "Buenos Aires", destino: "Tucum√°n", fecha: "2025-12-31", valor: 95000, tipo: "FTL" },
                    { origen: "Tucum√°n", destino: "C√≥rdoba", fecha: "2025-12-29", valor: 58000, tipo: "LTL" }
                ],
                cargasRecomendadas: [
                    { ruta: "C√≥rdoba ‚Üí Buenos Aires", probabilidad: 91, valor: "$62,000" },
                    { ruta: "C√≥rdoba ‚Üí Rosario", probabilidad: 72, valor: "$45,000" }
                ]
            },
            {
                id: 3, nombre: "Carlos Rodr√≠guez", telefono: "+54 261 456-7890", score: 85,
                viajes: 32, reservas: 25, conversion: 78, valor: 1620000,
                rutas: [
                    { origen: "Mendoza", destino: "San Juan", fecha: "2026-01-01", valor: 42000, tipo: "LTL" },
                    { origen: "San Juan", destino: "Buenos Aires", fecha: "2025-12-30", valor: 88000, tipo: "FTL" },
                    { origen: "Buenos Aires", destino: "Mendoza", fecha: "2025-12-28", valor: 85000, tipo: "FTL" }
                ],
                cargasRecomendadas: [
                    { ruta: "Mendoza ‚Üí Buenos Aires", probabilidad: 89, valor: "$82,000" },
                    { ruta: "Mendoza ‚Üí San Luis", probabilidad: 65, valor: "$38,000" }
                ]
            },
            {
                id: 4, nombre: "Ana Mart√≠nez", telefono: "+54 341 234-5678", score: 91,
                viajes: 41, reservas: 36, conversion: 88, valor: 2150000,
                rutas: [
                    { origen: "Rosario", destino: "Buenos Aires", fecha: "2026-01-02", valor: 52000, tipo: "FTL" },
                    { origen: "Buenos Aires", destino: "Mar del Plata", fecha: "2026-01-01", valor: 48000, tipo: "LTL" },
                    { origen: "Mar del Plata", destino: "Rosario", fecha: "2025-12-30", valor: 65000, tipo: "FTL" }
                ],
                cargasRecomendadas: [
                    { ruta: "Rosario ‚Üí Buenos Aires", probabilidad: 96, valor: "$52,000" },
                    { ruta: "Rosario ‚Üí C√≥rdoba", probabilidad: 81, valor: "$48,000" }
                ]
            },
            {
                id: 5, nombre: "Roberto S√°nchez", telefono: "+54 381 345-6789", score: 79,
                viajes: 28, reservas: 21, conversion: 75, valor: 1280000,
                rutas: [
                    { origen: "Tucum√°n", destino: "Buenos Aires", fecha: "2026-01-01", valor: 95000, tipo: "FTL" },
                    { origen: "Buenos Aires", destino: "Salta", fecha: "2025-12-29", valor: 110000, tipo: "FTL" },
                    { origen: "Salta", destino: "Tucum√°n", fecha: "2025-12-27", valor: 45000, tipo: "LTL" }
                ],
                cargasRecomendadas: [
                    { ruta: "Tucum√°n ‚Üí C√≥rdoba", probabilidad: 82, valor: "$58,000" },
                    { ruta: "Tucum√°n ‚Üí Buenos Aires", probabilidad: 74, valor: "$95,000" }
                ]
            },
            {
                id: 6, nombre: "Laura Fern√°ndez", telefono: "+54 11 567-8901", score: 94,
                viajes: 52, reservas: 47, conversion: 90, valor: 2890000,
                rutas: [
                    { origen: "Buenos Aires", destino: "Neuqu√©n", fecha: "2026-01-02", valor: 125000, tipo: "FTL" },
                    { origen: "Neuqu√©n", destino: "Bah√≠a Blanca", fecha: "2025-12-31", valor: 68000, tipo: "LTL" },
                    { origen: "Bah√≠a Blanca", destino: "Buenos Aires", fecha: "2025-12-29", valor: 72000, tipo: "FTL" }
                ],
                cargasRecomendadas: [
                    { ruta: "Buenos Aires ‚Üí Neuqu√©n", probabilidad: 97, valor: "$125,000" },
                    { ruta: "Buenos Aires ‚Üí Bah√≠a Blanca", probabilidad: 88, valor: "$72,000" }
                ]
            },
            {
                id: 7, nombre: "Diego L√≥pez", telefono: "+54 299 678-9012", score: 76,
                viajes: 24, reservas: 17, conversion: 71, valor: 980000,
                rutas: [
                    { origen: "Neuqu√©n", destino: "Buenos Aires", fecha: "2026-01-01", valor: 125000, tipo: "FTL" },
                    { origen: "Buenos Aires", destino: "C√≥rdoba", fecha: "2025-12-30", valor: 62000, tipo: "LTL" }
                ],
                cargasRecomendadas: [
                    { ruta: "Neuqu√©n ‚Üí Mendoza", probabilidad: 71, valor: "$85,000" },
                    { ruta: "Neuqu√©n ‚Üí Buenos Aires", probabilidad: 68, valor: "$125,000" }
                ]
            },
            {
                id: 8, nombre: "Patricia G√≥mez", telefono: "+54 223 789-0123", score: 87,
                viajes: 35, reservas: 29, conversion: 83, valor: 1720000,
                rutas: [
                    { origen: "Mar del Plata", destino: "Buenos Aires", fecha: "2026-01-02", valor: 48000, tipo: "LTL" },
                    { origen: "Buenos Aires", destino: "Rosario", fecha: "2026-01-01", valor: 52000, tipo: "FTL" },
                    { origen: "Rosario", destino: "Mar del Plata", fecha: "2025-12-30", valor: 78000, tipo: "FTL" }
                ],
                cargasRecomendadas: [
                    { ruta: "Mar del Plata ‚Üí Buenos Aires", probabilidad: 93, valor: "$48,000" },
                    { ruta: "Mar del Plata ‚Üí La Plata", probabilidad: 76, valor: "$32,000" }
                ]
            }
        ];

        // Coordenadas de ciudades argentinas
        const ciudades = {
            "Buenos Aires": [-34.6037, -58.3816],
            "C√≥rdoba": [-31.4201, -64.1888],
            "Rosario": [-32.9468, -60.6393],
            "Mendoza": [-32.8908, -68.8272],
            "Tucum√°n": [-26.8083, -65.2176],
            "Mar del Plata": [-38.0055, -57.5426],
            "Salta": [-24.7821, -65.4232],
            "San Juan": [-31.5375, -68.5364],
            "Neuqu√©n": [-38.9516, -68.0591],
            "Bah√≠a Blanca": [-38.7196, -62.2724],
            "San Luis": [-33.3017, -66.3378],
            "La Plata": [-34.9205, -57.9536]
        };

        let map;
        let currentRouteLayer;
        let markers = [];
        let selectedTransportista = null;

        // ============================================
        // FUNCIONES DE NAVEGACI√ìN
        // ============================================
        function showTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(el => {
                el.classList.remove('active');
            });
            
            // Reset all tab buttons
            document.querySelectorAll('.tab-button').forEach(el => {
                el.classList.remove('active');
                el.classList.add('text-zinc-500');
                el.classList.remove('text-white');
            });
            
            // Show selected tab
            document.getElementById('content-' + tabId).classList.add('active');
            
            // Activate button
            const btn = document.getElementById('tab-' + tabId);
            btn.classList.add('active');
            btn.classList.remove('text-zinc-500');
            btn.classList.add('text-white');
            
            // Initialize map if geo tab
            if (tabId === 'geo') {
                setTimeout(() => {
                    if (!map) initMap();
                    else map.invalidateSize();
                }, 100);
            }
            
            // Reinitialize charts
            initCharts();
        }

        // ============================================
        // FUNCIONES DE TRANSPORTISTAS
        // ============================================
        function renderTransportistasList() {
            const container = document.getElementById('transportistasList');
            const mapContainer = document.getElementById('mapTransportistasList');
            
            const html = transportistas.map(t => `
                <div class="table-row p-3 rounded-lg cursor-pointer" 
                     onclick="selectTransportista(${t.id})" id="transp-${t.id}">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-zinc-900 rounded-lg flex items-center justify-center">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="${t.score >= 90 ? '#10b981' : t.score >= 80 ? '#f59e0b' : '#71717a'}" stroke-width="2">
                                    <rect x="1" y="3" width="15" height="13"></rect>
                                    <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                                    <circle cx="5.5" cy="18.5" r="2.5"></circle>
                                    <circle cx="18.5" cy="18.5" r="2.5"></circle>
                                </svg>
                            </div>
                            <div>
                                <div class="font-semibold text-white text-sm">${t.nombre}</div>
                                <div class="text-xs text-zinc-500">${t.viajes} viajes ¬∑ ${t.conversion}% conv.</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-bold ${t.score >= 90 ? 'text-emerald-400' : t.score >= 80 ? 'text-amber-400' : 'text-zinc-500'}">${t.score}%</div>
                            <div class="text-xs text-zinc-600">score</div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
            mapContainer.innerHTML = html.replace(/selectTransportista/g, 'selectTransportistaMap');
        }

        function selectTransportista(id) {
            selectedTransportista = transportistas.find(t => t.id === id);
            
            // Update selection visual
            document.querySelectorAll('#transportistasList .table-row').forEach(el => el.classList.remove('selected'));
            document.getElementById(`transp-${id}`).classList.add('selected');
            
            // Show detail
            document.getElementById('transportistaPlaceholder').classList.add('hidden');
            document.getElementById('transportistaDetail').classList.remove('hidden');
            
            // Fill data
            document.getElementById('detailNombre').textContent = selectedTransportista.nombre;
            document.getElementById('detailTelefono').textContent = selectedTransportista.telefono;
            document.getElementById('detailScore').textContent = selectedTransportista.score + '%';
            document.getElementById('detailViajes').textContent = selectedTransportista.viajes;
            document.getElementById('detailReservas').textContent = selectedTransportista.reservas;
            document.getElementById('detailConversion').textContent = selectedTransportista.conversion + '%';
            document.getElementById('detailValor').textContent = '$' + (selectedTransportista.valor / 1000000).toFixed(1) + 'M';
            
            // Render routes
            const rutasHtml = selectedTransportista.rutas.map((r, idx) => `
                <div class="flex items-center justify-between p-3 bg-zinc-900/30 rounded-lg hover:bg-zinc-900/50 cursor-pointer transition-all border border-zinc-800"
                     onclick="showRouteOnMap('${r.origen}', '${r.destino}', '${selectedTransportista.nombre}')">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg bg-amber-500/10 flex items-center justify-center">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                        </div>
                        <div>
                            <div class="text-sm font-medium text-white">${r.origen} ‚Üí ${r.destino}</div>
                            <div class="text-xs text-zinc-500">${r.fecha} ¬∑ ${r.tipo}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-emerald-400 font-semibold text-sm">$${(r.valor / 1000).toFixed(0)}K</div>
                        <div class="text-xs text-zinc-600">Ver mapa ‚Üí</div>
                    </div>
                </div>
            `).join('');
            document.getElementById('rutasHistorial').innerHTML = rutasHtml;
            
            // Render recommended loads
            const cargasHtml = selectedTransportista.cargasRecomendadas.map(c => `
                <div class="bg-zinc-900/30 rounded-lg p-4 border border-amber-500/20">
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-sm font-medium text-white">${c.ruta}</span>
                        <span class="text-xs px-2 py-1 bg-amber-500/20 text-amber-400 rounded-full font-semibold">${c.probabilidad}% match</span>
                    </div>
                    <div class="flex items-center justify-between text-xs mb-2">
                        <span class="text-zinc-500">Valor estimado</span>
                        <span class="text-emerald-400 font-semibold">${c.valor}</span>
                    </div>
                    <div class="w-full bg-zinc-800 rounded-full h-1.5">
                        <div class="bg-gradient-to-r from-amber-500 to-orange-500 h-1.5 rounded-full progress-bar-animated" style="width: ${c.probabilidad}%"></div>
                    </div>
                </div>
            `).join('');
            document.getElementById('cargasRecomendadas').innerHTML = cargasHtml;
        }

        function selectTransportistaMap(id) {
            selectedTransportista = transportistas.find(t => t.id === id);
            
            // Update visual selection
            document.querySelectorAll('#mapTransportistasList .table-row').forEach(el => el.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            
            // Update KPI
            document.getElementById('mapTransportistaActivo').textContent = selectedTransportista.nombre;
            
            // Show all routes
            clearMap();
            
            selectedTransportista.rutas.forEach((ruta, idx) => {
                setTimeout(() => {
                    addRouteToMap(ruta.origen, ruta.destino, selectedTransportista.nombre, idx === 0);
                }, idx * 300);
            });
        }

        function filterTransportistas() {
            const search = document.getElementById('searchTransportista').value.toLowerCase();
            document.querySelectorAll('#transportistasList .table-row').forEach(el => {
                const nombre = el.querySelector('.font-semibold').textContent.toLowerCase();
                el.style.display = nombre.includes(search) ? 'block' : 'none';
            });
        }

        // ============================================
        // FUNCIONES DEL MAPA
        // ============================================
        function initMap() {
            map = L.map('map', {
                zoomControl: true,
                scrollWheelZoom: true
            }).setView([-34.6037, -64.0], 5);

            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; OpenStreetMap contributors &copy; CARTO',
                subdomains: 'abcd',
                maxZoom: 19
            }).addTo(map);

            // Add city markers
            Object.entries(ciudades).forEach(([nombre, coords]) => {
                L.circleMarker(coords, {
                    radius: 6,
                    fillColor: '#3B82F6',
                    color: '#1E40AF',
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0.8
                }).addTo(map).bindPopup(`<b>${nombre}</b>`);
            });
        }

        function clearMap() {
            if (currentRouteLayer) {
                map.removeLayer(currentRouteLayer);
            }
            markers.forEach(m => map.removeLayer(m));
            markers = [];
        }

        function addRouteToMap(origen, destino, transportista, fitBounds = true) {
            const coordsOrigen = ciudades[origen];
            const coordsDestino = ciudades[destino];
            
            if (!coordsOrigen || !coordsDestino) return;

            // Origin marker (green)
            const markerOrigen = L.circleMarker(coordsOrigen, {
                radius: 12,
                fillColor: '#10B981',
                color: '#059669',
                weight: 3,
                opacity: 1,
                fillOpacity: 0.9
            }).addTo(map).bindPopup(`
                <div style="text-align:center; padding: 8px;">
                    <b style="color:#10B981; font-size: 12px;">üìç ORIGEN</b><br>
                    <span style="font-size:14px; font-weight: 600; color: white;">${origen}</span><br>
                    <small style="color:#888;">Transportista: ${transportista}</small>
                </div>
            `);
            markers.push(markerOrigen);

            // Destination marker (red)
            const markerDestino = L.circleMarker(coordsDestino, {
                radius: 12,
                fillColor: '#EF4444',
                color: '#DC2626',
                weight: 3,
                opacity: 1,
                fillOpacity: 0.9
            }).addTo(map).bindPopup(`
                <div style="text-align:center; padding: 8px;">
                    <b style="color:#EF4444; font-size: 12px;">üéØ DESTINO</b><br>
                    <span style="font-size:14px; font-weight: 600; color: white;">${destino}</span><br>
                    <small style="color:#888;">Transportista: ${transportista}</small>
                </div>
            `);
            markers.push(markerDestino);

            // Route line (golden)
            const routeLine = L.polyline([coordsOrigen, coordsDestino], {
                color: '#F59E0B',
                weight: 5,
                opacity: 0.9,
                dashArray: '10, 10',
                lineCap: 'round'
            }).addTo(map);
            
            // Animate route
            let offset = 0;
            setInterval(() => {
                offset = (offset + 1) % 20;
                routeLine.setStyle({ dashOffset: -offset });
            }, 50);
            
            markers.push(routeLine);

            // Arrow in the middle
            const midPoint = [
                (coordsOrigen[0] + coordsDestino[0]) / 2,
                (coordsOrigen[1] + coordsDestino[1]) / 2
            ];
            
            const arrowIcon = L.divIcon({
                className: 'custom-arrow',
                html: `<div style="font-size: 24px; filter: drop-shadow(0 0 8px rgba(245,158,11,0.8));">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="#f59e0b" stroke="#fff" stroke-width="1.5">
                        <rect x="1" y="3" width="15" height="13"></rect>
                        <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                        <circle cx="5.5" cy="18.5" r="2.5"></circle>
                        <circle cx="18.5" cy="18.5" r="2.5"></circle>
                    </svg>
                </div>`,
                iconSize: [30, 30],
                iconAnchor: [15, 15]
            });
            
            const arrowMarker = L.marker(midPoint, { icon: arrowIcon }).addTo(map);
            markers.push(arrowMarker);

            // Fit bounds
            if (fitBounds) {
                const bounds = L.latLngBounds([coordsOrigen, coordsDestino]);
                map.fitBounds(bounds, { padding: [50, 50] });
            }
        }

        function showRouteOnMap(origen, destino, transportista) {
            showTab('geo');
            
            setTimeout(() => {
                clearMap();
                addRouteToMap(origen, destino, transportista);
                document.getElementById('mapTransportistaActivo').textContent = transportista;
            }, 200);
        }

        // ============================================
        // CHART.JS CONFIGURACI√ìN
        // ============================================
        Chart.defaults.color = '#71717a';
        Chart.defaults.borderColor = '#27272a';
        Chart.defaults.font.family = 'Inter';

        let chartInstances = {};

        function initCharts() {
            Object.values(chartInstances).forEach(chart => {
                if (chart) chart.destroy();
            });
            chartInstances = {};

            // Tendencia Semanal
            const ctxTendencia = document.getElementById('chartTendencia');
            if (ctxTendencia) {
                chartInstances.tendencia = new Chart(ctxTendencia, {
                    type: 'line',
                    data: {
                        labels: ['Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b', 'Dom'],
                        datasets: [{
                            label: 'Interacciones',
                            data: [420, 485, 510, 478, 520, 245, 189],
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 2
                        }, {
                            label: 'Reservas',
                            data: [62, 78, 85, 71, 89, 28, 10],
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                position: 'bottom',
                                labels: { padding: 15, usePointStyle: true }
                            } 
                        },
                        scales: { 
                            y: { 
                                beginAtZero: true, 
                                grid: { color: '#18181b' },
                                border: { display: false }
                            }, 
                            x: { 
                                grid: { display: false },
                                border: { display: false }
                            } 
                        }
                    }
                });
            }

            // Intenciones Donut
            const ctxIntenciones = document.getElementById('chartIntenciones');
            if (ctxIntenciones) {
                chartInstances.intenciones = new Chart(ctxIntenciones, {
                    type: 'doughnut',
                    data: {
                        labels: ['Consultar', 'Reservar', 'Rechazar', 'Contraoferta'],
                        datasets: [{
                            data: [1856, 423, 312, 156],
                            backgroundColor: ['#3B82F6', '#10B981', '#EF4444', '#F59E0B'],
                            borderWidth: 0,
                            spacing: 3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: { legend: { display: false } }
                    }
                });
            }

            // Actividad por Hora
            const ctxHoras = document.getElementById('chartHoras');
            if (ctxHoras) {
                chartInstances.horas = new Chart(ctxHoras, {
                    type: 'bar',
                    data: {
                        labels: ['06', '07', '08', '09', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20'],
                        datasets: [{
                            data: [45, 120, 285, 380, 420, 395, 310, 285, 340, 365, 320, 280, 185, 95, 42],
                            backgroundColor: (ctx) => ctx.raw > 350 ? '#3B82F6' : '#3f3f46',
                            borderRadius: 4,
                            borderSkipped: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { 
                            y: { display: false }, 
                            x: { 
                                grid: { display: false },
                                border: { display: false }
                            } 
                        }
                    }
                });
            }

            // Conversion por D√≠a
            const ctxConvDia = document.getElementById('chartConversionDia');
            if (ctxConvDia) {
                chartInstances.convDia = new Chart(ctxConvDia, {
                    type: 'bar',
                    data: {
                        labels: ['Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b', 'Dom'],
                        datasets: [{
                            label: 'Tasa Conversi√≥n %',
                            data: [14.8, 16.1, 16.7, 14.9, 17.1, 11.4, 5.3],
                            backgroundColor: '#10B981',
                            borderRadius: 6,
                            borderSkipped: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { 
                            y: { 
                                beginAtZero: true, 
                                grid: { color: '#18181b' },
                                border: { display: false }
                            }, 
                            x: { 
                                grid: { display: false },
                                border: { display: false }
                            } 
                        }
                    }
                });
            }

            // Reservas vs Rechazos
            const ctxRR = document.getElementById('chartReservasRechazos');
            if (ctxRR) {
                chartInstances.reservasRechazos = new Chart(ctxRR, {
                    type: 'bar',
                    data: {
                        labels: ['Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b', 'Dom'],
                        datasets: [{
                            label: 'Reservas',
                            data: [62, 78, 85, 71, 89, 28, 10],
                            backgroundColor: '#10B981',
                            borderRadius: 4,
                            borderSkipped: false
                        }, {
                            label: 'Rechazos',
                            data: [38, 45, 52, 48, 55, 42, 32],
                            backgroundColor: '#EF4444',
                            borderRadius: 4,
                            borderSkipped: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                position: 'bottom',
                                labels: { padding: 15, usePointStyle: true }
                            } 
                        },
                        scales: { 
                            y: { 
                                beginAtZero: true, 
                                grid: { color: '#18181b' },
                                border: { display: false }
                            }, 
                            x: { 
                                grid: { display: false },
                                border: { display: false }
                            } 
                        }
                    }
                });
            }

            // Acciones IA
            const ctxAcciones = document.getElementById('chartAccionesIA');
            if (ctxAcciones) {
                chartInstances.acciones = new Chart(ctxAcciones, {
                    type: 'bar',
                    data: {
                        labels: ['Mostrar Oferta', 'Procesar Reserva', 'Consultar Precio', 'Contraoferta', 'Cancelar', 'Fallback'],
                        datasets: [{
                            data: [1245, 423, 856, 156, 89, 78],
                            backgroundColor: ['#3B82F6', '#10B981', '#8B5CF6', '#F59E0B', '#71717a', '#EF4444'],
                            borderRadius: 6,
                            borderSkipped: false
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { 
                            x: { 
                                grid: { color: '#18181b' },
                                border: { display: false }
                            }, 
                            y: { 
                                grid: { display: false },
                                border: { display: false }
                            } 
                        }
                    }
                });
            }

            // Tiempo Respuesta
            const ctxTiempo = document.getElementById('chartTiempoRespuesta');
            if (ctxTiempo) {
                chartInstances.tiempo = new Chart(ctxTiempo, {
                    type: 'line',
                    data: {
                        labels: ['06', '08', '10', '12', '14', '16', '18', '20'],
                        datasets: [{
                            label: 'Tiempo (s)',
                            data: [0.8, 1.1, 1.4, 1.6, 1.3, 1.2, 1.0, 0.9],
                            borderColor: '#06B6D4',
                            backgroundColor: 'rgba(6, 182, 212, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { 
                            y: { 
                                beginAtZero: true, 
                                grid: { color: '#18181b' },
                                border: { display: false }
                            }, 
                            x: { 
                                grid: { display: false },
                                border: { display: false }
                            } 
                        }
                    }
                });
            }
        }

        // ============================================
        // INICIALIZACI√ìN
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            renderTransportistasList();
            initCharts();
        });
    </script>
</body>
</html>
